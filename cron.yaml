apiVersion: batch/v1
kind: CronJob
metadata:
  name: status-check-cron
  namespace: learndevopsnow
spec:
  schedule: "*/30 * * * *" # Every 30 minutes
  startingDeadlineSeconds: 300
  successfulJobsHistoryLimit: 2
  failedJobsHistoryLimit: 3
  jobTemplate:
    spec:
      backoffLimit: 3
      activeDeadlineSeconds: 600
      template:
        spec:
          containers:
          - name: status-checker
            image: mahar.azurecr.io/ldn-status-api:latest
            command: ["python", "manage.py", "check_services"]
          restartPolicy: OnFailure

---
apiVersion: batch/v1
kind: CronJob
metadata:
  name: cleanup-data-cron
  namespace: learndevopsnow
spec:
  schedule: "0 12 */3 * *" # At 12:00 PM, every 3 days
  concurrencyPolicy: Forbid
  successfulJobsHistoryLimit: 2
  failedJobsHistoryLimit: 2
  jobTemplate:
    spec:
      backoffLimit: 2
      activeDeadlineSeconds: 1800  # 30 minutes max for cleanup
      template:
        spec:
          containers:
          - name: cleanup-data
            image: mahar.azurecr.io/ldn-status-api:latest
            command: ["python", "manage.py", "cleanup_old_data"]
          restartPolicy: OnFailure